---
import type { CollectionEntry } from 'astro:content'
import PostMetaInfo from './PostMetaInfo.astro'

interface Props {
  entry: CollectionEntry<'posts'>
}

const { entry } = Astro.props

const { remarkPluginFrontmatter } = await entry.render()
---

<a class="post-card block relative py-8 focus-visible:outline-0" href={`/posts/${entry.slug}`}>
  <div class="post-card-overlay absolute inset-y-4 -inset-x-4 -z-1 bg-accent/10 rounded-lg opacity-0 scale-95 transition-all duration-200"></div>
  <h2 class="relative text-2xl font-bold">
    {entry.data.title}
    {
      entry.data.sticky > 0 && (
        <i class="absolute right-0 top-0 z-10 size-6 leading-none iconfont icon-pushpin text-red-500" />
      )
    }
  </h2>
  <div class="mt-4 overflow-hidden">
    {
      entry.data.cover && (
        <img
          class="float-right ml-3 mb-2 size-[80px] rounded-md object-cover select-none"
          src={entry.data.cover}
          alt={entry.data.title}
          loading="lazy"
        />
      )
    }
    {entry.data.summary && <p>{entry.data.summary}</p>}
  </div>
  <div class="mt-2 flex flex-wrap items-center justify-end gap-4 select-none">
    <PostMetaInfo
      class="grow"
      date={entry.data.date}
      lastMod={entry.data.lastMod}
      words={remarkPluginFrontmatter.words}
      readingMinutes={remarkPluginFrontmatter.readingMinutes}
    />
    <div class="group shrink-0 text-accent flex items-center gap-2">
      <span>继续阅读</span>
      <svg width="36" height="12" viewBox="0 0 36 12" fill="none" class="stroke-current">
        <path
          d="M0.75 6H11.25 M6 0.75L11.25 6L6 11.25"
          stroke-linecap="round"
          stroke-linejoin="round"></path>
        <path
          d="M15 10L19.5 5.5L15 1"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="delay-100 opacity-0 group-hover:opacity-100"></path>
        <path
          d="M23 10L27.5 5.5L23 1"
          stroke-opacity="0.66"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="delay-200 opacity-0 group-hover:opacity-100"></path>
        <path
          d="M31 10L35.5 5.5L31 1"
          stroke-opacity="0.35"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="delay-300 opacity-0 group-hover:opacity-100"></path>
      </svg>
    </div>
  </div>
</a>

<script>
  function initPostCardHover() {
    const cards = document.querySelectorAll('.post-card')

    cards.forEach(card => {
      const overlay = card.querySelector('.post-card-overlay')
      if (!overlay) return

      const handleMouseEnter = () => {
        overlay.classList.remove('opacity-0', 'scale-95')
        overlay.classList.add('opacity-100', 'scale-100')
      }

      const handleMouseLeave = () => {
        overlay.classList.remove('opacity-100', 'scale-100')
        overlay.classList.add('opacity-0', 'scale-95')
      }

      card.addEventListener('mouseenter', handleMouseEnter)
      card.addEventListener('mouseleave', handleMouseLeave)
      card.addEventListener('focus', handleMouseEnter)
      card.addEventListener('blur', handleMouseLeave)
    })
  }

  // 初始化
  initPostCardHover()

  // Swup 路由切换后重新初始化
  document.addEventListener('swup:page:view', initPostCardHover)
</script>
